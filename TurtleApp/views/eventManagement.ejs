<h1 style="text-align: center;">Events</h1>

<style>
  table {
    width: 90%;
    margin: 0 auto;
    border-collapse: collapse;
    font-family: Arial, sans-serif;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
  }
  th {
    background-color: #f4f4f4;
    font-weight: bold;
  }
  tr:hover {
    background-color: #f1f1f1;
  }
  h1 {
    margin-bottom: 20px;
  }
  button {
    margin: 0 5px;
  }
</style>
  <table>
    <thead>
      <tr>
        <th>PreferredEventDate</th>
        <th>Contact_First</th>
        <th>Contact_Last</th>
        <th>Contact_Phone</th>
        <th>Number of Participants</th>
        <th>EventStart</th>
        <th>EventDuration</th>
        <th>EventAddress</th>
        <th>SewingPreference</th>
        <th>JenStory</th>
        <th>EventDetails</th>
        <th>EventStatus</th>
      </tr>
    </thead>
    <tbody>
      <% if (events.length > 0) { %>
        <% events.forEach(row => { %>
          <tr>
            <input type="hidden" value="row.eventid">
            <td><%= new Date(row.confirmedeventdate).toLocaleDateString('en-US') %></td>
            <td><%= row.contact_first %></td>
            <td><%= row.contact_last %></td>
            <td> <!-- Phone logic to account for 7 digit and 10 digit phone numbers and if it doesn't fit display the non formatted number-->
                <%= (() => {
                  const cleaned = row.contactphone.replace(/\D/g, ''); // Remove non-numeric characters
                  if (cleaned.length === 10) {
                    // Format with area code (e.g., 509-123-4352)
                    return `${cleaned.slice(0, 3)}-${cleaned.slice(3, 6)}-${cleaned.slice(6)}`;
                  } else if (cleaned.length === 7) {
                    // Format without area code (e.g., 123-4352)
                    return `${cleaned.slice(0, 3)}-${cleaned.slice(3)}`;
                  } else {
                    // Return as is if it doesn't match expected lengths
                    return row.contactphone;
                  }
                })() %>
              </td>
            <td><%= row.numparticipants %></td>
            <td><%= row.eventstart %></td>
            <td><%= row.eventduration.hours %> hours, <%= row.eventduration.minutes %> minutes</td>
            <td><%= row.streetaddress %>, <%= row.city %>, <%= row.state %>, <%= row.zip %></td>
            <td><%= row.sewing_description %></td>
            <td><%= row.jenstory ? 'Yes' : 'No' %></td>
            <td><%= row.eventdetails %></td>
            <td><%= row.status_description %></td>
            <td>
              <form action="/eventdetails/<%= row.id %>" method="GET" style="display:inline;">
                <button type="submit">View</button>
              </form>
              <form action="/editevent/<%= row.id %>" method="GET" style="display:inline;">
                <button type="submit">Edit</button>
              </form>
              <form action="/deleteevent/<%= row.id %>" method="POST" style="display:inline;">
                <button type="submit" onclick="return confirm('Are you sure you want to delete this record?');">Delete</button>
              </form>
            </td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr>
          <td colspan="7">No data available</td>
        </tr>
      <% } %>
    </tbody>
  </table>